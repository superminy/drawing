<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>
    <style>
        #interactive.viewport { width: 100%; max-width: 800px; height: 450px; position: relative; background: #000; margin: auto; }
        #interactive.viewport > video, canvas { width: 100%; height: 100%; position: absolute; top: 0; left: 0; object-fit: cover; }
        .guide-line { position: absolute; top: 50%; left: 10%; width: 80%; height: 2px; background: red; z-index: 10; opacity: 0.5; }
        #result { text-align: center; font-size: 24px; font-weight: bold; margin-top: 20px; color: #007bff; }
    </style>
</head>
<body>
    <div id="interactive" class="viewport">
        <div class="guide-line"></div> </div>
    <div id="result">가로 바코드를 빨간 선에 맞춰주세요</div>

    <script>
        Quagga.init({
            inputStream: {
                type: "LiveStream",
                constraints: {
                    width: { ideal: 1920 }, // 1D 바코드는 해상도가 생명입니다
                    height: { ideal: 1080 },
                    facingMode: "environment"
                },
                target: document.querySelector('#interactive')
            },
            locator: {
                patchSize: "large", // 긴 바코드를 찾기 위해 영역 확대
                halfSample: false   // 정밀도를 위해 해상도 축소 안함 (중요!)
            },
            decoder: {
                readers: ["code_128_reader"] // 오직 CODE_128에만 집중
            },
            locate: true
        }, function(err) {
            if (err) return console.error(err);
            Quagga.start();
        });

        Quagga.onDetected(function(data) {
            document.getElementById('result').innerText = "스캔 완료: " + data.codeResult.code;
            if (navigator.vibrate) navigator.vibrate(200);
        });
    </script>
</body>
</html>
